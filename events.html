<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Events • OSU Day Traders</title>

  <link rel="stylesheet" href="css/style.css"/>
  <link rel="icon" href="assets/icons/favicon.ico" />

  <meta property="og:title" content="OSU Day Traders – Events & Workshops" />
  <meta property="og:description" content="Interactive calendar of OSU Day Traders meetings, workshops, and speakers." />
  <meta property="og:image" content="assets/images/osu-daytraders-logo.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <style>
    :root{
      --scarlet:#c4122f; --ink:#121212; --muted:#646464; --panel:#fff; --surface:#f6f6f6;
    }
    body{background:var(--surface)}
    .calendar-wrap h1{color:var(--ink)}

    .calendar-wrap{max-width:1100px;margin:0 auto;padding:1.5rem 1rem 3rem}
    .cal-header{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin:.25rem auto 1.2rem;max-width:980px}
    .cal-title{font-size:1.75rem;font-weight:900;margin:0}
    .cal-controls{display:flex;gap:.5rem}
    .cal-btn{border:1px solid #e8e8e8;background:#fff;border-radius:999px;padding:.55rem .85rem;font-weight:800;cursor:pointer;box-shadow:0 10px 24px rgba(0,0,0,.06)}
    .cal-btn:hover{filter:brightness(.97)}
    .cal-btn:active{transform:translateY(1px)}

    .calendar{--gap:.65rem;display:grid;gap:var(--gap);grid-template-columns:repeat(7,1fr);max-width:980px;margin:0 auto}

    /* weekday header in scarlet */
    .cal-dow{
      font-size:.78rem;font-weight:900;text-transform:uppercase;letter-spacing:.08em;
      color:#fff;background:var(--scarlet);border-radius:12px;text-align:center;padding:.5rem .4rem;
      box-shadow:0 10px 24px rgba(196,18,47,.18);
    }

    .cal-cell{
      background:linear-gradient(180deg,#ffffff,#fbfbfb);
      border:1px solid #eee;border-radius:18px;min-height:122px;padding:.65rem .65rem .7rem;
      display:flex;flex-direction:column;gap:.45rem;box-shadow:0 16px 38px rgba(0,0,0,.06);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .cal-cell:hover{ transform:translateY(-2px); box-shadow:0 24px 50px rgba(0,0,0,.1) }
    .cal-cell.muted{opacity:.45}
    .cal-date{font-weight:900;font-size:.95rem;color:#333}

    /* red event bar; left padding prevents dot overlap */
    .event-bar{
      position:relative;
      display:block;width:100%;
      background:var(--scarlet); color:#fff;
      border-radius:14px; padding:.55rem .7rem .6rem 1.6rem;
      line-height:1.25; font-size:.88rem; font-weight:800;
      box-shadow:0 10px 26px rgba(196,18,47,.25);
    }
    .event-bar + .event-bar{margin-top:.35rem}
    .event-bar small{
      display:block; margin-top:.15rem; font-weight:700; opacity:.95; letter-spacing:.01em;
    }
    .event-dot{
      position:absolute; left:.6rem; top:.72rem; width:.5rem; height:.5rem; border-radius:999px;
      background:#fff; opacity:.95;
    }

    .legend{max-width:980px;margin:1.1rem auto 0;color:#666;font-size:.92rem}

    /* Drawer */
    .drawer{position:fixed;inset:auto 0 0 0;max-height:66vh;background:#fff;border-top:1px solid #eee;box-shadow:0 -28px 80px rgba(0,0,0,.2);transform:translateY(100%);transition:transform .18s ease;z-index:40}
    .drawer.show{transform:translateY(0)}
    .drawer-head{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid #eee}
    .drawer-title{margin:0;font-size:1.05rem;font-weight:900}
    .drawer-body{padding:1rem;display:grid;gap:.85rem;max-height:52vh;overflow:auto;background:linear-gradient(180deg,#fff,#fafafa)}
    .card{border:1px solid #eee;border-radius:16px;padding:.95rem;background:#fff;box-shadow:0 12px 26px rgba(0,0,0,.07)}
    .card h4{margin:.1rem 0 .35rem 0}
    .meta{font-size:.92rem;color:#666}
    .desc{margin:.45rem 0 0 0;color:#3f3f3f}
    .actions{margin-top:.7rem;display:flex;gap:.5rem;flex-wrap:wrap}
    .btn{display:inline-block;text-decoration:none;font-weight:900;padding:.72rem 1rem;border-radius:999px;border:1px solid #111;background:#111;color:#fff}
    .btn--light{background:#fff;color:#111;border:1px solid #ddd}
    .btn--scarlet{background:var(--scarlet);border-color:var(--scarlet);color:#fff}

    @media (max-width:760px){
      .cal-cell{min-height:92px}
      .event-bar{font-size:.86rem}
    }
  </style>
</head>
<body>

  <header class="site-header">
    <a class="brand" href="index.html">
      <img src="assets/images/osu-daytraders-logo.png" alt="OSU Day Traders Logo"/>
      <span>OSU Day Traders</span>
    </a>
    <nav class="site-nav" aria-label="Main navigation">
      <button class="nav-toggle" aria-expanded="false" aria-controls="navMenu">☰</button>
      <ul id="navMenu">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a class="active" href="events.html">Events</a></li>
        <li><a href="resources.html">Resources</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="applications.html">Applications</a></li>
      </ul>
    </nav>
  </header>

  <main class="calendar-wrap">
    <div class="cal-header">
      <h1 class="cal-title" id="calTitle">Events Calendar</h1>
      <div class="cal-controls">
        <button class="cal-btn" id="prevBtn" type="button" aria-label="Previous month">‹</button>
        <button class="cal-btn" id="todayBtn" type="button">This month</button>
        <button class="cal-btn" id="nextBtn" type="button" aria-label="Next month">›</button>
      </div>
    </div>

    <div class="calendar" id="calendar"></div>

    <p class="legend">
      All times Eastern. Click a date to view details and Zoom registration.
    </p>
  </main>

  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="drawer-head">
      <h3 class="drawer-title" id="drawerTitle">Events</h3>
      <button class="cal-btn" id="closeDrawer" type="button">Close</button>
    </div>
    <div class="drawer-body" id="drawerBody"></div>
  </aside>

  <footer class="site-footer">
    <p>&copy; <span id="year"></span> OSU Day Traders • Student Organization</p>
  </footer>

  <script src="js/main.js"></script>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // ====== Event data (virtual-only) ======
    const today = new Date();
    const ONE_OFF_EVENTS = [{
      name: "Weekly Meeting",
      type: "Club Meeting",
      start: new Date(today.getFullYear(), today.getMonth(), 17, 18, 0), // 17th @ 6:00 PM ET
      duration: 75,
      location: null,                 // no physical location
      virtual: true,                  // mark virtual
      zoom: "https://osu.zoom.us/meeting/register/OBKK4x6ARW-nLENvzqbGAg",
      description: "Market rundown, risk review, and a breakout scalp workflow."
    }];
    const RECUR_RULES = [];

    // ====== Utilities ======
    const DOW = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    function pad(n){ return String(n).padStart(2,"0"); }
    function toKey(d){ return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
    function startOfMonth(d){ return new Date(d.getFullYear(), d.getMonth(), 1); }
    function endOfMonth(d){ return new Date(d.getFullYear(), d.getMonth()+1, 0); }
    function addDays(d, n){ const x = new Date(d); x.setDate(x.getDate()+n); return x; }
    function formatTime(d){ return d.toLocaleTimeString([], {hour: "numeric", minute: "2-digit"}); }
    function gcal(ev){
      const end = new Date(ev.start.getTime() + (ev.duration||60)*60000);
      const fmt = d => `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}T${pad(d.getHours())}${pad(d.getMinutes())}00`;
      const details = `${ev.type?ev.type+" — ":""}${ev.description||""}\n${ev.zoom?"Zoom: "+ev.zoom:""}`;
      const qs = new URLSearchParams({
        action:"TEMPLATE",
        text: ev.name,
        details,
        location: ev.location ? ev.location : "Virtual",
        dates: `${fmt(ev.start)}/${fmt(end)}`
      });
      return `https://calendar.google.com/calendar/render?${qs.toString()}`;
    }

    function nthWeekdayOfMonth(year, monthIndex, weekday, nth){
      const first = new Date(year, monthIndex, 1);
      let delta = weekday - first.getDay(); if (delta < 0) delta += 7;
      const date = 1 + delta + (nth-1)*7;
      return new Date(year, monthIndex, date);
    }
    function expandRecurring(rules, from, to){
      const out = [];
      for (const r of rules){
        if (r.recur?.freq === "WEEKLY"){
          let d = new Date(from);
          while (d.getDay() !== r.recur.weekday) d = addDays(d,1);
          while (d <= to){
            const [h,m] = (r.time||"19:00").split(":").map(Number);
            const start = new Date(d.getFullYear(), d.getMonth(), d.getDate(), h, m);
            out.push({...r, start});
            d = addDays(d,7);
          }
        } else if (r.recur?.freq === "MONTHLY"){
          let cursor = new Date(from.getFullYear(), from.getMonth(), 1);
          while (cursor <= to){
            const target = nthWeekdayOfMonth(cursor.getFullYear(), cursor.getMonth(), r.recur.weekday, r.recur.nth || 1);
            if (target >= from && target <= to){
              const [h,m] = (r.time||"19:00").split(":").map(Number);
              const start = new Date(target.getFullYear(), target.getMonth(), target.getDate(), h, m);
              out.push({...r, start});
            }
            cursor = new Date(cursor.getFullYear(), cursor.getMonth()+1, 1);
          }
        }
      }
      return out.sort((a,b)=>a.start-b.start);
    }

    // ====== Rendering ======
    const cal = document.getElementById("calendar");
    const titleEl = document.getElementById("calTitle");
    const drawer = document.getElementById("drawer");
    const drawerBody = document.getElementById("drawerBody");
    const drawerTitle = document.getElementById("drawerTitle");
    document.getElementById("closeDrawer").onclick = () => drawer.classList.remove("show");

    const now = new Date();
    let view = new Date(now.getFullYear(), now.getMonth(), 1);

    document.getElementById("prevBtn").onclick = ()=>{ view = new Date(view.getFullYear(), view.getMonth()-1, 1); render(); };
    document.getElementById("nextBtn").onclick = ()=>{ view = new Date(view.getFullYear(), view.getMonth()+1, 1); render(); };
    document.getElementById("todayBtn").onclick = ()=>{ view = new Date(now.getFullYear(), now.getMonth(), 1); render(); };

    function render(){
      cal.innerHTML = "";
      // weekday header
      for (const d of DOW){
        const h = document.createElement("div");
        h.className = "cal-dow";
        h.textContent = d;
        cal.appendChild(h);
      }

      // month grid
      const start = startOfMonth(view);
      const end = endOfMonth(view);
      const lead = (start.getDay()+7)%7;
      const firstCell = addDays(start, -lead);
      const totalDays = lead + end.getDate();
      const tail = (7 - (totalDays % 7)) % 7;
      const lastCell = addDays(end, tail);

      const recurred = expandRecurring(RECUR_RULES, firstCell, lastCell);
      const events = [...recurred, ...ONE_OFF_EVENTS.filter(e => e.start >= firstCell && e.start <= lastCell)]
        .sort((a,b)=>a.start-b.start);

      const index = {};
      for (const e of events){
        const k = toKey(e.start);
        (index[k] ||= []).push(e);
      }

      const monthName = view.toLocaleString(undefined,{month:"long", year:"numeric"});
      titleEl.textContent = `Events Calendar — ${monthName}`;

      for (let d = new Date(firstCell); d <= lastCell; d = addDays(d,1)){
        const cell = document.createElement("div");
        cell.className = "cal-cell";
        if (d.getMonth() !== view.getMonth()) cell.classList.add("muted");

        const dateEl = document.createElement("div");
        dateEl.className = "cal-date";
        dateEl.textContent = d.getDate();
        cell.appendChild(dateEl);

        const key = toKey(d);
        const dayEvents = index[key] || [];
        for (const ev of dayEvents){
          const bar = document.createElement("a");
          bar.href = "#";
          bar.className = "event-bar";
          const locationText = ev.location ? ` • ${ev.location}` : " • Virtual";
          bar.innerHTML = `
            <span class="event-dot" aria-hidden="true"></span>
            ${ev.name}
            <small>${formatTime(ev.start)} ET${locationText}</small>
          `;
          bar.addEventListener("click", (e)=>{ e.preventDefault(); openDrawer(d, dayEvents); });
          cell.appendChild(bar);
        }

        cell.addEventListener("click", (e)=>{
          if (e.target.closest(".event-bar")) return;
          openDrawer(d, dayEvents);
        });

        cal.appendChild(cell);
      }
    }

    function openDrawer(date, events){
      drawerTitle.textContent = date.toLocaleDateString(undefined,{weekday:"long", month:"long", day:"numeric", year:"numeric"});
      drawerBody.innerHTML = "";
      if (!events.length){
        const empty = document.createElement("div");
        empty.className = "card";
        empty.innerHTML = "<p>No scheduled events on this date.</p>";
        drawerBody.appendChild(empty);
      } else {
        for (const ev of events){
          const card = document.createElement("div");
          card.className = "card";
          const where = ev.location ? ev.location : "Virtual (Zoom)";
          card.innerHTML = `
            <h4>${ev.name}</h4>
            <div class="meta">${ev.type || "Event"} • ${formatTime(ev.start)} ET • ${where}</div>
            ${ev.description ? `<p class="desc">${ev.description}</p>` : ""}
            ${ev.zoom ? `<p class="desc"><a class="btn btn--light" href="${ev.zoom}" target="_blank" rel="noopener">Zoom registration</a></p>` : ""}
            <div class="actions">
              <a class="btn btn--scarlet" href="${gcal(ev)}" target="_blank" rel="noopener">Add to Google Calendar</a>
              <a class="btn btn--light" href="applications.html#member">Join the club</a>
            </div>
          `;
          drawerBody.appendChild(card);
        }
      }
      drawer.classList.add("show");
    }

    render();
  </script>
</body>
</html>
